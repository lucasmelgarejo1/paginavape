<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tienda de Vapers</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="favicon.jpg" type="image/png" />

</head>
<body>
<a href="https://wa.me/5493487652952" class="wsp-fijo" target="_blank" aria-label="WhatsApp">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="icono-wsp">
</a>



  <header class="video-header">
  <video autoplay muted loop playsinline>
    <source src="/assets/Ink-35508-1.mp4" type="video/mp4" />
    Tu navegador no soporta videos HTML5.
  </video>
  <div class="overlay">
    <div class="admin-controls" style="position:absolute; top:10px; right:10px; display:flex; gap:8px;">
  <button id="btn-login" style="padding:6px 10px; border-radius:8px;">Admin</button>
  <button id="btn-logout" style="padding:6px 10px; border-radius:8px; display:none;">Salir</button>
</div>
     <div class="anuncio-carrusel">
      <div class="mensaje" id="mensaje-rotativo">üì± Seguinos en Instagram @vapezrt_</div>
    </div>
    <h1>VAPEZRT</h1>
    <div class="busqueda">
    <input type="text" id="buscador" placeholder="Buscar productos... üîç" />
  </div>
  </div>
</header> 

<section class="hero">
  <img id="hero-imagen" src="/assets/2023_1120_Ignite_Lifestyle_MikeKirschbaum_016_1_1000x.webp" alt="Portada de Vapers" />
  <div class="hero-texto">
    <h2>Explor√° nuestros sabores</h2>
    <p>Los mejores sabores, los mejores precios.</p>
  </div>
</section>


<main id="productos" class="productos">
  <!-- Ac√° se insertan los productos -->
</main>


  <footer id="contacto" class="footer">
  <div class="footer-contenido">
    <h2>VAPEZRT</h2>
    <p>üî• Los mejores sabores. Atenci√≥n personalizada.</p>
    
    <div class="footer-contacto">
      <!-- <p><strong>Email:</strong> contacto@vapeshop.com</p> -->
      <p><strong>WhatsApp:</strong> <a href="https://wa.me/5493487652952" target="_blank">+54 9 3487 652952</a></p>
      <p><strong>Instagram:</strong> <a href="https://instagram.com/vapezrt_" target="_blank">@vapezrt_</a></p>
    </div>
  </div>
  
  <div class="footer-copy">
    <p>&copy; 2025 VAPEZRT. Todos los derechos reservados.</p>
  </div>
</footer>


<script>
  // Rotaci√≥n del mensaje superior
  const mensajes = [
    "üì± Seguinos en Instagram @vapezrt_",
    "üïí Horarios: lunes a lunes de 10 AM a 00:00"
  ];

  let index = 0;
  const mensajeEl = document.getElementById("mensaje-rotativo");

  function actualizarMensaje() {
    mensajeEl.textContent = mensajes[index];
    mensajeEl.style.animation = "none";
    void mensajeEl.offsetWidth;
    mensajeEl.style.animation = "slide 16s linear infinite";
    index = (index + 1) % mensajes.length;
  }

  setInterval(actualizarMensaje, 16000);
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBkCmjY9pCUXLia-fsw9Od4AybFxRzCAjg",
    authDomain: "vapezrt-56f20.firebaseapp.com",
    projectId: "vapezrt-56f20",
    storageBucket: "vapezrt-56f20.appspot.com",
    messagingSenderId: "1000261974016",
    appId: "1:1000261974016:web:281161e24522eb2bee00e5",
    measurementId: "G-B84Z2N19NE"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const contenedor = document.querySelector(".productos");
  const buscador = document.getElementById("buscador");
  const btnLogin = document.getElementById("btn-login");
  const btnLogout = document.getElementById("btn-logout");

  let isAdmin = false;

  // ¬øEl usuario logueado est√° en /admins/{uid}?
  async function checkAdmin(uid) {
    const ref = doc(db, "admins", uid);
    const snap = await getDoc(ref);
    return snap.exists();
  }

  // Render de una tarjeta de producto (incluye ‚ÄúEditar stock‚Äù si isAdmin)
  function renderProducto(prod, id) {
    const tarjeta = document.createElement("div");
    tarjeta.classList.add("producto");

    tarjeta.innerHTML = `
      <img src="${prod.imagen}" alt="${prod.nombre}">
      <h3>${prod.nombre}</h3>
      <p>${prod.sabor}</p>
      ${isAdmin ? `<button class="btn-editar" style="margin-top:8px; padding:6px 10px; border-radius:8px;">Editar stock</button>` : ""}
    `;

    // Click abre modal (tu l√≥gica actual, sin stock visible)
    tarjeta.addEventListener("click", () => {
      document.getElementById("modal-img").src = prod.imagen;
      document.getElementById("modal-nombre").textContent = prod.nombre;
      document.getElementById("modal-sabor").textContent = prod.sabor;
      document.getElementById("modal-wsp").href =
        `https://wa.me/5493487652952?text=Hola!%20Estoy%20interesado%20en%20${encodeURIComponent(prod.nombre)}%20(${encodeURIComponent(prod.sabor)})`;
      document.getElementById("modal").classList.remove("hidden");
    });

    // Bot√≥n ‚ÄúEditar stock‚Äù solo si es admin
    if (isAdmin) {
      const btn = tarjeta.querySelector(".btn-editar");
      btn.addEventListener("click", async (e) => {
        e.stopPropagation(); // no abrir modal
        const actual = Number.isFinite(prod.stock) ? prod.stock : 0;
        const entrada = prompt(`Nuevo stock para "${prod.nombre}" (${prod.sabor}):`, actual);
        if (entrada === null) return;
        const valor = parseInt(entrada, 10);
        if (Number.isNaN(valor) || valor < 0) {
          alert("Ingres√° un n√∫mero v√°lido (>= 0).");
          return;
        }
        try {
          await updateDoc(doc(db, "productos", id), { stock: valor });
          alert("Stock actualizado ‚úÖ");
        } catch (err) {
          console.error(err);
          alert("No se pudo actualizar el stock.");
        }
      });
    }

    contenedor.appendChild(tarjeta);
  }

  async function cargarProductos() {
    contenedor.innerHTML = "";
    try {
      const qs = await getDocs(collection(db, "productos"));
      qs.forEach((d) => {
        const prod = d.data();
        renderProducto(prod, d.id); // pasamos el id del doc
      });

      // Buscador (post-render)
      buscador.addEventListener("input", () => {
        const filtro = buscador.value.toLowerCase();
        const tarjetas = document.querySelectorAll(".producto");
        tarjetas.forEach((card) => {
          const texto = card.innerText.toLowerCase();
          card.style.display = texto.includes(filtro) ? "block" : "none";
        });
      });

    } catch (error) {
      console.error("Error al cargar productos:", error);
      contenedor.innerHTML = "<p>No se pudieron cargar los productos.</p>";
    }
  }

  // Login / Logout
  btnLogin?.addEventListener("click", async () => {
    try {
      await signInWithPopup(auth, provider);
    } catch (e) {
      console.error(e);
      alert("No se pudo iniciar sesi√≥n.");
    }
  });
  btnLogout?.addEventListener("click", async () => {
    await signOut(auth);
  });

  // Cambios de sesi√≥n
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // Toggle botones
      btnLogin.style.display = "none";
      btnLogout.style.display = "inline-block";
      // ¬øEs admin?
      isAdmin = await checkAdmin(user.uid);
    } else {
      btnLogin.style.display = "inline-block";
      btnLogout.style.display = "none";
      isAdmin = false;
    }
    // Re-render seg√∫n permisos
    cargarProductos();
  });

  // Primer render (usuario no logueado)
  cargarProductos();
</script>


<script>
  // L√≥gica para cerrar el modal
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("cerrarModal").addEventListener("click", () => {
      document.getElementById("modal").classList.add("hidden");
    });

    window.addEventListener("click", (e) => {
      const modal = document.getElementById("modal");
      if (e.target === modal) {
        modal.classList.add("hidden");
      }
    });
  });
</script>
<script>
  const imagenesHero = [
    "/assets/2023_1120_Ignite_Lifestyle_MikeKirschbaum_016_1_1000x.webp",
    "assets/Imagen de WhatsApp 2025-07-17 a las 22.23.09_bf985f76.webp.jpg",
    "/assets/Imagen de WhatsApp 2025-07-18 a las 01.27.53_af5c1526.jpg"
  ];

  let indexHero = 0;
  const heroImg = document.getElementById("hero-imagen");

  setInterval(() => {
    indexHero = (indexHero + 1) % imagenesHero.length;
    heroImg.src = imagenesHero[indexHero];
  }, 5000); // cambia cada 5 segundos
</script>


<div id="modal" class="modal hidden">
  <div class="modal-content">
    <span id="cerrarModal" class="cerrar">&times;</span>
    <img id="modal-img" src="" alt="">
    <h3 id="modal-nombre"></h3>
    <p id="modal-sabor"></p>
    <!-- <p id="modal-stock"></p> -->
    <a id="modal-wsp" href="#" target="_blank" class="btn-wsp">Consultar por WhatsApp</a>
  </div>
</div>


</body>
</html>
